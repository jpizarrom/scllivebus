language: node_js

node_js:
  - 6

build:
  ci:
    - npm prune
    - shippable_retry npm install --unsafe-perm
    - shippable_retry npm update --unsafe-perm
#    - npm test

  post_ci:
    - >-
       CI= shippable_retry npm run build &&
       cd build &&
       echo scllivebus.pedalean.com > CNAME &&
       git init &&
       git add -A . &&
       git config user.email "jpizarrom@gmail.com" &&
       git config user.name "jpizarrom" &&
       git commit -m "Update demo for ${GIT_TAG_NAME} [skip ci]" &&
       git remote add origin git@github.com:${REPO_FULL_NAME}.git &&
       shippable_retry git push origin master:gh-pages -f;

  cache: true
  cache_dir_list:
    - $SHIPPABLE_BUILD_DIR/node_modules
    - $SHIPPABLE_BUILD_DIR/elm-stuff
    - $SHIPPABLE_BUILD_DIR/.git

branches:
  except:
    - gh-pages
